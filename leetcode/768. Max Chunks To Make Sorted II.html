<body>
  <script>
    /**
     * @param {number[]} arr
     * @return {number}
     */
    var maxChunksToSorted = function (arr) {
      // 使用单调栈+修正
      const stack = [],
        len = arr.length
      stack.top = function () {
        // arr[i] will be an integer in range [0, 10**8].
        return this[this.length - 1] === undefined
          ? -1
          : this[this.length - 1]
      }
      for (let i = 0; i < len; i++) {
        if (stack.top() === -1) {
          stack.push(arr[i])
          continue
        }
        const head = stack.pop()
        if (head <= arr[i]) {
          stack.push(arr[i])
          stack.push(head)
          continue
        }
        // 修正
        while (arr[i] < stack.top()) {
          stack.pop()
        }
        stack.push(head)
      }
      return stack.length
    }

    var maxChunksToSorted = function (arr) {
      const stack = []
      let max = -1
      for (let i = 0; i < arr.length; i++) {
        if (arr[i] >= max) {
          stack.push(arr[i])
          max = arr[i]
        } else {
          while (
            arr[i] < stack[stack.length - 1] &&
            stack.length
          ) {
            stack.pop()
          }
          stack.push(max)
        }
      }
      return stack.length
    }

    console.log(maxChunksToSorted([1, 0, 1, 3, 2]))
  </script>
</body>