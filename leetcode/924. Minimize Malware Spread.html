<!--
 * @Author: SedationH
 * @Date: 2020-07-25 09:32:00
 * @LastEditTime: 2020-07-26 10:56:12
 * @FilePath: /learn-algorithm/leetcode/924. Minimize Malware Spread.html
-->

<body>

  <script>
    /**
     * @param {number[][]} graph
     * @param {number[]} initial
     * @return {number}
     */
    /**
     * 整体思路
     *  前提条件：建立可查询集合大小的并查集结构对象
     *  graph -> uf: UnionFind 
     *  initial每次去掉一个，查看此时的传染个数 比对极值和保持较小即可
     */
    var minMalwareSpread = function (graph, initial) {

      class UnionFind {

        constructor(size) {
          this.parents = Array(size)
            .fill(0)
            .map((_, i) => i)
          this.sizes = Array(size).fill(1)
        }

        find(x) {
          if (x !== this.parents[x]) {
            this.parents[x] = this.find(this.parents[x])
          }
          return this.parents[x]
        }

        /**
         * 获取所在集合的大小
         */
        getSize(x) {
          return this.sizes[
            this.find(x)
          ]
        }

        /**
         * 比对size的大小，把小的加入大的，相等就b加入a
         */
        union(a, b) {
          const fa = this.find(a), fb = this.find(b)
          if (fa !== fb) {
            if (this.sizes[fa] < this.sizes[fb]) {
              this.parents[fa] = fb
              // fb是root
              this.sizes[fb] += this.sizes[fa]
            } else {
              this.parents[fb] = fa
              // fa是root
              this.sizes[fa] += this.sizes[fb]
            }
          }
        }
      }
      
      const uf = new UnionFind(graph.length)
      // 根据graph构建uf
      for (let i = 0; i < graph.length; i++) {
        for (let j = 0; j < graph.length; j++) {
          graph[i][j] === 1 && uf.union(i, j)
        }
      }

      let minNumbers = Infinity, minIndex = initial[0]
      for (let i = 0; i < initial.length; i++) {
        let temNumbers = getInfectedNumbers([
          ...initial.slice(0, i),
          ...initial.slice(i + 1)
        ])
        if (minNumbers > temNumbers) {
          minIndex = initial[i]
          minNumbers = temNumbers
        } else if (minNumbers === temNumbers && minIndex > initial[i]) {
          minIndex = initial[i]
        }
      }
      return minIndex

      /**
       * 根据inital & uf 获得感染人数
       */
      function getInfectedNumbers(initial) {
        // 去重
        const roots = []
        for (let i = 0; i < initial.length; i++) {
          const p = uf.find(initial[i])
          roots.includes(p) || roots.push(p)
        }
        return roots.reduce(
          (prev, curr) => prev + uf.getSize(curr),
          0
        )
      }

    };
    console.log(
      minMalwareSpread(
        [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 1], [0, 0, 1, 1]],
        [3, 1]
      )
    )
  </script>
</body>